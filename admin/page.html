<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YPP Admin Panel</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="/css/style.css">
    
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/e4704dcbbd.js" crossorigin="anonymous"></script>

    <!-- Style -->
    <style>
        :root{
            --mxw: 1200px;
            --gap: 16px;
            --box-color: #d9d9d9;
            --line-color: #ececec;
        }
        body{
            min-height: 100dvh;
        }
        p, span{margin-bottom: 0; color: #000;}
        /* =========== */

        .main-container{ max-width: var(--mxw); margin: 0 auto; padding: 20px; box-sizing: border-box;}
        
        /* =========== */

        .links{position: fixed;bottom: 25px;left: 25px;}
        .links a img{
            width: 2.25rem;
            box-shadow: 0 1px 5px rgb(0 0 0 / 56%);
            border-radius: 7px;
        }
        .links a:hover img{
            transform: scale(1.05);
            transition: all 0.3s ease;
        }

        /* =========== */
        /* =========== Clock Styles =========== */
        header{width: 100%;display: flex; justify-content: space-between;padding: 10px 0;}
        .clock-widget {font-size: 1.1rem;}
        /* =========== */
        .page-top{
            /* border-bottom: 1px solid var(--line-color); */
            padding: 1rem 0 1rem 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            flex-direction: column;
            gap: 2rem;
        }
        .page-title{font-size: 2.5rem;}
        .page-info{display: flex; flex-direction: column; gap: 4px; text-align: right;font-size: .8rem;}
        .page-count{font-size: 1.8rem;}
        .page-count i{font-size: 1rem; margin-bottom: 1rem;}

        /* =========== Data List Styles =========== */
        /* .data-container {margin-top: 2rem;} */
        
        .data-toolbar {
            display: flex;
            justify-content: end;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .toolbar-left {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.8rem;
            margin: 0 0.125rem;
        }

        
        /* =========== Table Styles =========== */
        .data-table-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-height: 600px; /* 테이블 최대 높이 설정 */
            overflow-y: auto; /* 세로 스크롤 활성화 */
        }
        .data-table-container::-webkit-scrollbar { 
            width: 4px;
        }
        .data-table-container::-webkit-scrollbar-thumb { 
            background-color: #C6C6C6;
            border-radius: 3px;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th,
        .data-table td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10; /* 헤더가 위에 오도록 설정 */
            box-shadow: 0 2px 4px rgba(0,0,0,0.1); /* 헤더 하단에 그림자 추가 */
        }
        
        .data-table tbody tr:hover {
            background: #f8f9fa;
            cursor: pointer;
        }
        
        .data-table .col-checkbox { width: 40px; }
        .data-table .col-id { width: 80px; }
        .data-table .col-number { width: 80px; }
        .data-table .col-status,
        .data-table .col-actions,
        .data-table .col-date { width: auto; text-align: center;}
        .data-table .col-checkbox { text-align: center;}

        /* =========== Status Styles =========== */
        .status-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        /* .status-active { background: #d4edda; color: #155724; }
        .status-inactive { background: #f8d7da; color: #721c24; }
        .status-pending { background: #fff3cd; color: #856404; } */
        
        /* =========== Responsive =========== */
        @media (max-width: 768px) {
            .toolbar-left { flex-direction: column; gap: 0.5rem; }
        }
        
        @media (min-width: 769px) {
        }
    </style>
</head>
<body>
    <section class="links">
        <a href="/"><img src="/assets/images/favicon/apple-icon-76x76.png" alt="" srcset=""></a>
    </section>
    <div class="main-container">
        <header>
            <a href="/admin/" class="btn-home">
                <i class="fas fa-home"></i>
            </a>
            <div class="clock-widget">
                <span class="clock-date" id="clock-date"></span>
                <span class="clock-time">
                    <span id="clock-hours"></span>:<span id="clock-minutes"></span><span class="clock-period" id="clock-period"></span>
                </span>
            </div>
        </header>
        <main>
            <div class="page-top">
                <div class="page-title"></div>
                <div class="page-info">
                    <p class="page-count">
                        <i class="fas fa-spinner fa-spin"></i>
                    </p>
                    <p class="page-location">홈 > </p>
                    <p class="page-descripation">페이지 디스크립션</p>
                </div>
            </div>
            <div class="page-mid">
                <!-- 데이터 관리 컨테이너 -->
                <div class="data-container">

                    <!-- 툴바 -->
                    <div class="data-toolbar">
                        <div class="toolbar-left">
                            <button class="btn btn-primary" id="btn-add">
                                <i class="fas fa-plus"></i> 새로 추가
                            </button>
                            <button class="btn btn-danger" id="btn-delete-selected" disabled>
                                <i class="fas fa-trash"></i> 선택 삭제
                            </button>
                        </div>

                    </div>
                    
                    <!-- 테이블 (데스크톱) -->
                    <div class="data-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <!-- <th class="col-checkbox">
                                        <input type="checkbox" id="select-all">
                                    </th>
                                    <th class="col-id">ID</th>
                                    <th>제목</th>
                                    <th class="col-date">날짜</th>
                                    <th class="col-status">상태</th>
                                    <th class="col-actions">액션</th> -->
                                </tr>
                            </thead>
                            <tbody id="data-table-body">
                                <!-- 동적 생성 -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- 카드 (모바일) -->
                    <div class="data-cards" id="data-cards-container">
                        <!-- 동적 생성 -->
                    </div>
                    
                    
                    <!-- 로딩 표시 -->
                    <div id="loading-indicator" style="text-align: center; padding: 2rem;">
                        <i class="fas fa-spinner fa-spin"></i> 데이터를 불러오는 중...
                    </div>

                    <!-- 빈 상태 표시 -->
                    <div id="empty-state" style="display: none; text-align: center; padding: 3rem; color: #666;">
                        <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p>등록된 데이터가 없습니다.</p>
                        <button class="btn btn-primary" onclick="document.getElementById('btn-add').click()">
                            첫 번째 항목 추가하기
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-content"></div>
            <div class="modal-add"></div>
        </main>
    </div>
</body>
</html>

<script>
// 페이지 로드 시 실행
document.addEventListener('DOMContentLoaded', () => {
    console.log('YPP Admin Page 초기화...');
    const clock = new Clock(); // 시계 인스턴스 생성
    clock.start(); // 시계 시작
    const pageManager = new PageManager(); // 페이지 매니저 생성
    pageManager.init(); // 페이지 초기화
});

// 시계 클래스
class Clock {
    constructor() {
        this.intervalId = null;
    }
    
    start() {
        this.updateClock(); // 즉시 시계 업데이트
        this.intervalId = setInterval(() => this.updateClock(), 1000); // 1초마다 업데이트
    }
    
    stop() {
        if (this.intervalId) {
            clearInterval(this.intervalId);
            this.intervalId = null;
        }
    }
    
    updateClock() {
        const now = new Date();
        
        // 시간 계산 (12시간 형식)
        let hours = now.getHours();
        const minutes = now.getMinutes();
        const period = hours >= 12 ? 'PM' : 'AM';
        
        // 12시간 형식으로 변환
        if (hours > 12) {
            hours = hours - 12;
        } else if (hours === 0) {
            hours = 12;
        }
        
        // 날짜 계산
        const year = now.getFullYear();
        const month = now.getMonth() + 1;
        const date = now.getDate();
        
        // DOM 업데이트 (한자리수도 그대로 표시)
        document.getElementById('clock-hours').textContent = hours.toString();
        document.getElementById('clock-minutes').textContent = minutes.toString().padStart(2, '0'); // 분은 항상 2자리
        document.getElementById('clock-period').textContent = period;
        document.getElementById('clock-date').textContent = `${year}년 ${month}월 ${date}일`;
    }
}
// ===========================================================================================
// 날짜/시간 유틸리티 함수들
// ===========================================================================================

/**
 * datetime 문자열을 날짜와 시간으로 분리하는 함수
 * @param {string} datetime - "YYYY-MM-DD HH:mm:ss" 형식의 문자열
 * @returns {Object} {date: "YYYY-MM-DD", time: "HH:mm:ss", dateOnly: "YYYY-MM-DD", timeOnly: "HH:mm"}
 */
function parseDatetime(datetime) {
    if (!datetime || typeof datetime !== 'string') {
        return { date: '-', time: '-', dateOnly: '-', timeOnly: '-' };
    }
    
    try {
        const parts = datetime.split(' ');
        if (parts.length >= 2) {
            const datePart = parts[0]; // YYYY-MM-DD
            const timePart = parts[1]; // HH:mm:ss
            const timeOnly = timePart.substring(0, 5); // HH:mm만 추출
            
            return {
                date: datePart,
                time: timePart,
                dateOnly: datePart,
                timeOnly: timeOnly
            };
        }
        
        // 날짜만 있는 경우 (YYYY-MM-DD)
        if (datetime.includes('-') && !datetime.includes(' ')) {
            return {
                date: datetime,
                time: '-',
                dateOnly: datetime,
                timeOnly: '-'
            };
        }
        
        return { date: datetime, time: '-', dateOnly: datetime, timeOnly: '-' };
        
    } catch (error) {
        console.error('parseDatetime 에러:', error);
        return { date: datetime, time: '-', dateOnly: datetime, timeOnly: '-' };
    }
}

/**
 * 날짜를 한국어 형식으로 포맷팅
 * @param {string} dateStr - "YYYY-MM-DD" 형식
 * @returns {string} "YYYY년 MM월 DD일" 형식
 */
function formatKoreanDate(dateStr) {
    if (!dateStr || dateStr === '-') return '-';
    
    try {
        const parts = dateStr.split('-');
        if (parts.length === 3) {
            return `${parts[0]}년 ${parseInt(parts[1])}월 ${parseInt(parts[2])}일`;
        }
        return dateStr;
    } catch (error) {
        return dateStr;
    }
}

/**
 * 시간을 12시간 형식으로 변환
 * @param {string} timeStr - "HH:mm:ss" 또는 "HH:mm" 형식
 * @returns {string} "오전/오후 HH:mm" 형식
 */
function formatKoreanTime(timeStr) {
    if (!timeStr || timeStr === '-') return '-';
    
    try {
        const timeParts = timeStr.split(':');
        if (timeParts.length >= 2) {
            let hour = parseInt(timeParts[0]);
            const minute = timeParts[1];
            const period = hour >= 12 ? '오후' : '오전';
            
            if (hour > 12) hour -= 12;
            if (hour === 0) hour = 12;
            
            return `${period} ${hour}:${minute}`;
        }
        return timeStr;
    } catch (error) {
        return timeStr;
    }
}

// ===========================================================================================
// ===========================================================================================
// 페이지 관리 클래스
class PageManager {
    constructor() {
        // Google Apps Script 웹앱 URL (index.html과 동일)
        this.DASHBOARD_APPS_SCRIPT_ID = 'AKfycbxIahDUT9xuPXQht5ousfW4DY6MYQN0Qs5zuz8tCsu5tj2mQliH22GW2gnSKYw3kMo';
        this.appsScriptUrl = `https://script.google.com/macros/s/${this.DASHBOARD_APPS_SCRIPT_ID}/exec`;
        this.pageConfigs = this.initPageConfigs();
    }
    
    // 페이지별 설정 데이터 초기화
    initPageConfigs() {
        return {
            '팝업': {
                title: '팝업',
                description: '홈페이지 팝업 관리',
                location: '홈 > 팝업',
                apiSheet: 'SHEET_DASHBOARD', // 임시
                dataKey: 'popup'
            },
            '인허가': {
                title: '갤러리 인허가',
                description: '인허가 관련 갤러리 이미지 관리',
                location: '갤러리 > 인허가',
                apiSheet: 'SHEET_GAL_A',
                dataKey: 'galA'
            },
            '유자격': {
                title: '갤러리 유자격',
                description: '유자격 관련 갤러리 이미지 관리',
                location: '갤러리 > 유자격',
                apiSheet: 'SHEET_GAL_B',
                dataKey: 'galB'
            },
            '인사이드': {
                title: '갤러리 인사이드',
                description: '인사이드 관련 갤러리 컨텐츠 관리',
                location: '갤러리 > 인사이드',
                apiSheet: 'SHEET_GAL_C',
                dataKey: 'galC'
            },
            '아카데미': {
                title: '갤러리 아카데미',
                description: '아카데미 관련 갤러리 컨텐츠 관리',
                location: '갤러리 > 아카데미',
                apiSheet: 'SHEET_GAL_F',
                dataKey: 'galD'
            },
            '보도자료': {
                title: '보도자료',
                description: '언론 보도자료 및 뉴스 관리',
                location: '게시판 > 보도자료',
                apiSheet: 'SHEET_BOARD_NEWS',
                dataKey: 'boardNews'
            },
            'PSAC': {
                title: 'PSAC 신청',
                description: 'PSAC 교육과정 신청서 관리',
                location: '아카데미 > PSAC',
                apiSheet: 'SHEET_APPLY_P',
                dataKey: 'applyPSAC'
            },
            'RelaySchool': {
                title: 'Relay School 신청',
                description: 'Relay School 교육과정 신청서 관리',
                location: '아카데미 > Relay School',
                apiSheet: 'SHEET_APPLY_R',
                dataKey: 'applyRelay'
            },
            '자주묻는질문': {
                title: '자주 묻는 질문',
                description: 'FAQ 관리',
                location: '고객센터 > 자주 묻는 질문',
                apiSheet: 'SHEET_DASHBOARD', // 임시
                dataKey: 'faq'
            },
            '고객문의': {
                title: '고객문의',
                description: '고객 문의사항 관리',
                location: '고객센터 > 고객문의',
                apiSheet: 'SHEET_HELP_KR',
                dataKey: 'helpKR'
            },
            '부패및윤리신고': {
                title: '부패 및 윤리 신고',
                description: '부패신고 및 윤리위반 신고 관리',
                location: '고객센터 > 부패 및 윤리 신고',
                apiSheet: 'SHEET_REPORT',
                dataKey: 'report'
            }
        };
    }
    
    // 페이지 초기화
    async init() {
        const urlParams = new URLSearchParams(window.location.search);
        const pageParam = urlParams.get('page');
        
        if (!pageParam) {
            this.showError('페이지 파라미터가 없습니다.');
            return;
        }
        
        console.log(`페이지 파라미터: ${pageParam}`);
        
        const config = this.pageConfigs[pageParam];
        if (!config) {
            this.showError(`알 수 없는 페이지: ${pageParam}`);
            return;
        }
        
        // 페이지 정보 업데이트
        this.updatePageInfo(config);
        
        // 데이터 카운트 로드
        await this.loadPageCount(config);
        
        // 실제 데이터 로드 및 테이블 렌더링
        await this.loadPageData(config);
    }
    
    // 페이지 정보 업데이트
    updatePageInfo(config) {
        document.querySelector('.page-title').textContent = config.title;
        document.querySelector('.page-descripation').textContent = config.description;
        document.querySelector('.page-location').textContent = config.location;
        
        // 페이지 타이틀도 업데이트
        document.title = `YPP Admin - ${config.title}`;
    }
    
    // 페이지별 데이터 카운트 로드
    async loadPageCount(config) {
        try {
            // console.log(`${config.title} 데이터 카운트 로드 중...`);
            
            // 대시보드에서 카운트 정보 가져오기 (index.html과 동일한 URL 형식)
            const url = `${this.appsScriptUrl}?sheet=SHEET_DASHBOARD&action=getData`;
            const response = await fetch(url);
            const result = await response.json();
            
            if (!result.success) {
                throw new Error(result.message);
            }
            
            // console.log('=== 디버깅 정보 ===');
            // console.log('config:', config);
            // console.log('config.dataKey:', config.dataKey);
            // console.log('result.data:', result.data);
            // console.log('result.data[config.dataKey]:', result.data[config.dataKey]);
            
            const count = result.data[config.dataKey] || 0;
            document.querySelector('.page-count').textContent = `${count}건`;
            
            // console.log(`${config.title}: ${count}건`);
            // console.log('=== 디버깅 끝 ===');
            
        } catch (error) {
            console.error('데이터 카운트 로드 실패:', error);
            document.querySelector('.page-count').textContent = '0건';
        }
    }
    
    // 에러 표시
    showError(message) {
        document.querySelector('.page-title').textContent = '오류';
        document.querySelector('.page-descripation').textContent = message;
        document.querySelector('.page-location').textContent = '오류 페이지';
        document.querySelector('.page-count').textContent = '0건';
        
        console.error('PageManager 오류:', message);
    }
    
    // 페이지 데이터 로드
    async loadPageData(config) {
        try {
            this.showLoading(true);
            // console.log(`${config.title} 데이터 로드 중...`);
            
            // API에서 실제 데이터 가져오기 (index.html과 동일한 URL 형식)
            const url = `${this.appsScriptUrl}?sheet=${config.apiSheet}&action=getData`;
            const response = await fetch(url);
            const result = await response.json();
            
            if (!result.success) {
                throw new Error(result.message);
            }
            
            const data = result.data;
            console.log(`${config.title} 데이터:`, data);
            
            // 데이터가 있으면 테이블 렌더링, 없으면 빈 상태 표시
            if (data && data.length > 0) {
                this.renderDataTable(data, config);
                this.showEmptyState(false);
            } else {
                this.showEmptyState(true);
            }
            
        } catch (error) {
            console.error('데이터 로드 실패:', error);
            this.showError(`데이터 로드 실패: ${error.message}`);
        } finally {
            this.showLoading(false);
        }
    }
    
    // 테이블 렌더링 (데스크톱)
    renderDataTable(data, config) {
        const tbody = document.getElementById('data-table-body');
        const thead = document.querySelector('.data-table thead tr');
        
        // 테이블 헤더 동적 생성
        thead.innerHTML = this.generateTableHeaderHTML(config);
        
        // 데이터 그룹핑 적용 (PSAC, RelaySchool에서만)
        const processedData = this.groupDataByDateAndBusinessNumber(data);
        console.log('그룹핑 처리된 데이터:', processedData);
        
        // 테이블 바디 초기화 및 데이터 렌더링
        tbody.innerHTML = '';
        
        processedData.forEach((item, index) => {
            const row = document.createElement('tr');
            row.innerHTML = this.generateTableRowHTML(item, config);
            
            // 행 클릭 이벤트 (모달 열기 준비)
            row.addEventListener('click', (e) => {
                if (!e.target.matches('button, input[type="checkbox"]')) {
                    console.log('행 클릭됨:', item);
                    // 나중에 모달 열기 기능 추가
                }
            });
            
            tbody.appendChild(row);
        });
        
        // 체크박스 이벤트 설정
        this.setupCheckboxEvents();
    }

    // 테이블 헤더 HTML 생성
    generateTableHeaderHTML(config) {
        const pageType = new URLSearchParams(window.location.search).get('page');
        
        // 페이지 타입별로 다른 헤더 구조
        switch(pageType) {
            case '인허가':
            case '유자격':
                return `
                    <th class="col-checkbox"><input type="checkbox" id="select-all"></th>
                    <th>제목</th>
                    <th class="col-date">등록일</th>
                    <th class="col-status">상태</th>
                    <th class="col-actions">삭제</th>
                `;
            
            case '인사이드':
            case '아카데미':
                return `
                    <th class="col-checkbox"><input type="checkbox" id="select-all"></th>
                    <th>제목</th>
                    <th class="col-date">날짜</th>
                    <th class="col-status">상태</th>
                    <th class="col-actions">삭제</th>
                `;
                
            case 'PSAC':
            case 'RelaySchool':
                return `
                    <th class="col-checkbox"><input type="checkbox" id="select-all"></th>
                    <th class="col-number">순번</th>
                    <th>회사/기관</th>
                    <th>신청과목</th>
                    <th class="col-date">신청일</th>
                    <th class="col-actions">삭제</th>
                `;
                
            case '고객문의':
                return `
                    <th class="col-checkbox"><input type="checkbox" id="select-all"></th>
                    <th class="col-id">ID</th>
                    <th>제목</th>
                    <th>문의자</th>
                    <th>이메일</th>
                    <th class="col-date">문의일</th>
                    <th class="col-status">처리상태</th>
                    <th class="col-actions">삭제</th>
                `;
                
            case '보도자료':
                return `
                    <th class="col-checkbox"><input type="checkbox" id="select-all"></th>
                    <th class="col-id">ID</th>
                    <th>제목</th>
                    <th>내용</th>
                    <th class="col-date">발행일</th>
                    <th class="col-status">상태</th>
                    <th class="col-actions">삭제</th>
                `;
                
            case '부패및윤리신고':
                return `
                    <th class="col-checkbox"><input type="checkbox" id="select-all"></th>
                    <th class="col-id">ID</th>
                    <th>제목</th>
                    <th>신고자</th>
                    <th class="col-date">신고일</th>
                    <th class="col-status">처리상태</th>
                    <th class="col-actions">삭제</th>
                `;
                
            default: // 팝업, 자주묻는질문 등
                return `
                    <th class="col-checkbox"><input type="checkbox" id="select-all"></th>
                    <th class="col-id">ID</th>
                    <th>제목</th>
                    <th>내용</th>
                    <th class="col-date">등록일</th>
                    <th class="col-status">상태</th>
                    <th class="col-actions">삭제</th>
                `;
        }
    }
    
    // 데이터 그룹핑 함수 (날짜와 사업자등록번호로 그룹핑)
    groupDataByDateAndBusinessNumber(data) {
        const pageType = new URLSearchParams(window.location.search).get('page');
        
        // PSAC, RelaySchool 페이지에서만 그룹핑 적용
        if (!['PSAC', 'RelaySchool'].includes(pageType)) {
            return data;
        }
        
        const grouped = {};
        const result = [];
        
        data.forEach(item => {
            // 날짜 추출 (applicationDate 또는 educationSchedule에서)
            const datetime = parseDatetime(item.applicationDate || item.educationSchedule);
            const date = datetime.dateOnly;
            
            // 사업자등록번호 추출 (여러 필드명 지원)
            const businessNumber = item.businessNumber || item.companyRegistrationNumber || item.businessRegistrationNumber || '';
            
            // 그룹핑 키 생성 (날짜 + 사업자등록번호)
            // 사업자등록번호가 없으면 각각 별도 그룹으로 처리 (고유 ID 사용)
            let groupKey;
            if (businessNumber && businessNumber.trim() !== '') {
                groupKey = `${date}_${businessNumber.trim()}`;
            } else {
                // 사업자등록번호가 없으면 각 항목을 별도로 처리
                groupKey = `${date}_${item.number || item.id || Math.random()}`;
            }
            
            if (!grouped[groupKey]) {
                // 새 그룹 생성
                grouped[groupKey] = {
                    ...item, // 첫 번째 아이템의 기본 정보 사용
                    groupedEducation: [item.detailedEducation || ''], // 교육 내용들을 배열로 저장
                    groupedItems: [item], // 원본 아이템들 저장
                    isGrouped: true // 그룹핑된 데이터임을 표시
                };
            } else {
                // 기존 그룹에 추가
                grouped[groupKey].groupedEducation.push(item.detailedEducation || '');
                grouped[groupKey].groupedItems.push(item);
            }
        });
        
        // 그룹핑된 결과를 배열로 변환
        Object.values(grouped).forEach(group => {
            result.push(group);
        });
        
        console.log('그룹핑 결과:', {
            원본데이터개수: data.length,
            그룹핑후개수: result.length,
            그룹상세: result.map(item => ({
                회사: item.companyName,
                날짜: parseDatetime(item.applicationDate || item.educationSchedule).dateOnly,
                사업자번호: item.businessNumber || item.companyRegistrationNumber || item.businessRegistrationNumber,
                교육개수: item.groupedEducation.length,
                교육내용: item.groupedEducation
            }))
        });
        
        return result;
    }

    // 테이블 행 HTML 생성
    generateTableRowHTML(item, config) {
        const pageType = new URLSearchParams(window.location.search).get('page');
        
        // 페이지 타입별로 다른 컬럼 구조
        switch(pageType) {
            case '인허가':
            case '유자격':
                return `
                    <td class="col-checkbox"><input type="checkbox" data-id="${item.id}"></td>
                    <td>${item.titleKR || '제목 없음'}</td>
                    <td class="col-date">${item.date || '-'}</td>
                    <td class="col-status"><span class="status-badge ${item.state === 'on' ? 'status-active' : 'status-inactive'}">${item.state === 'on' ? 'ON' : 'OFF'}</span></td>
                    <td class="col-actions">
                        <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.id}')"><i class="fa-solid fa-trash-can"></i></button>
                    </td>
                `;
            
            case '인사이드':
            case '아카데미':
                return `
                    <td class="col-checkbox"><input type="checkbox" data-id="${item.id}"></td>
                    <td>${item.titleKR || '제목 없음'}</td>
                    <td class="col-date">${item.date || ''}</td>
                    <td class="col-status"><span class="status-badge ${item.state === 'on' ? 'status-active' : 'status-inactive'}">${item.state === 'on' ? 'ON' : 'OFF'}</span></td>
                    <td class="col-actions">
                        <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.id}')"><i class="fa-solid fa-trash-can"></i></button>
                    </td>
                `;
                
            case 'PSAC':
            case 'RelaySchool':
                const datetime = parseDatetime(item.applicationDate || item.educationSchedule);
                
                // 그룹핑된 데이터인지 확인
                if (item.isGrouped && item.groupedEducation && item.groupedEducation.length > 1) {
                    // 그룹핑된 여러 교육 내용을 <br>로 구분해서 표시
                    const educationList = item.groupedEducation
                        .filter(edu => edu && edu.trim()) // 빈 값 제거
                        .map((edu, index) => `<span style="display: block; padding: 2px 0;">${edu.trim()}</span>`)
                        .join('');
                        
                    return `
                        <td class="col-checkbox"><input type="checkbox" data-id="${item.number}"></td>
                        <td>${item.number}</td>
                        <td>${item.companyName || '-'}</td>
                        <td style="background-color: #f8f9fa; border-left: 3px solid #007bff; padding-left: 8px;">
                            <div style="font-weight: 500; color: #495057; margin-bottom: 4px;">
                                <i class="fas fa-layer-group" style="color: #007bff; margin-right: 4px;"></i>
                                그룹 (${item.groupedEducation.length}개 과목)
                            </div>
                            ${educationList}
                        </td>
                        <td>
                            <div>${datetime.dateOnly}</div>
                            <small style="color: #666;">${datetime.timeOnly}</small>
                        </td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.number}')"><i class="fa-solid fa-trash-can"></i></button>
                        </td>
                    `;
                } else {
                    // 단일 데이터
                    return `
                        <td class="col-checkbox"><input type="checkbox" data-id="${item.number}"></td>
                        <td>${item.number}</td>
                        <td>${item.companyName || '-'}</td>
                        <td>${item.detailedEducation || ''}</td>
                        <td>
                            <div>${datetime.dateOnly}</div>
                            <small style="color: #666;">${datetime.timeOnly}</small>
                        </td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.number}')"><i class="fa-solid fa-trash-can"></i></button>
                        </td>
                    `;
                }
            case '고객문의':
                const inquiryDatetime = parseDatetime(item.submittedAt);
                return `
                    <td class="col-checkbox"><input type="checkbox" data-id="${item.submissionId}"></td>
                    <td>${item.submissionId}</td>
                    <td>${item.subject || '제목 없음'}</td>
                    <td>${item.nameCompany || '-'}</td>
                    <td>${item.emailPhone || '-'}</td>
                    <td>
                        <div>${inquiryDatetime.dateOnly}</div>
                        <small style="color: #666;">${inquiryDatetime.timeOnly}</small>
                    </td>
                    <td><span class="status-badge status-pending">접수</span></td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.submissionId}')"><i class="fa-solid fa-trash-can"></i></button>
                    </td>
                `;
                
            case '보도자료':
                return `
                    <td class="col-checkbox"><input type="checkbox" data-id="${item.id}"></td>
                    <td>${item.id}</td>
                    <td>${item.title || '제목 없음'}</td>
                    <td>${item.content ? (item.content.length > 30 ? item.content.substring(0, 30) + '...' : item.content) : '내용 없음'}</td>
                    <td>${item.publishDate || '-'}</td>
                    <td><span class="status-badge status-active">게시중</span></td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.id}')"><i class="fa-solid fa-trash-can"></i></button>
                    </td>
                `;
                
            case '부패및윤리신고':
                return `
                    <td class="col-checkbox"><input type="checkbox" data-id="${item.id}"></td>
                    <td>${item.id}</td>
                    <td>${item.subject || '제목 없음'}</td>
                    <td>${item.reporterName || '익명'}</td>
                    <td>${item.reportDate || '-'}</td>
                    <td><span class="status-badge ${item.status === '완료' ? 'status-active' : 'status-pending'}">${item.status || '접수'}</span></td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.id}')"><i class="fa-solid fa-trash-can"></i></button>
                    </td>
                `;
                
            default: // 팝업, 자주묻는질문 등
                return `
                    <td class="col-checkbox"><input type="checkbox" data-id="${item.id}"></td>
                    <td>${item.id}</td>
                    <td>${item.title || item.subject || '제목 없음'}</td>
                    <td>${item.content ? (item.content.length > 30 ? item.content.substring(0, 30) + '...' : item.content) : '내용 없음'}</td>
                    <td class="col-date">${item.date || item.createdDate || '-'}</td>
                    <td><span class="status-badge status-active">활성</span></td>
                    <td>
                        <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.id}')"><i class="fa-solid fa-trash-can"></i></button>
                    </td>
                `;
        }
    }
    
    // 체크박스 이벤트 설정
    setupCheckboxEvents() {
        const selectAll = document.getElementById('select-all');
        const checkboxes = document.querySelectorAll('input[type="checkbox"][data-id]');
        const deleteBtn = document.getElementById('btn-delete-selected');
        
        // 전체 선택 체크박스
        selectAll.addEventListener('change', (e) => {
            checkboxes.forEach(cb => cb.checked = e.target.checked);
            this.updateDeleteButton();
        });
        
        // 개별 체크박스
        checkboxes.forEach(cb => {
            cb.addEventListener('change', () => {
                this.updateDeleteButton();
            });
        });
    }
    
    // 삭제 버튼 상태 업데이트
    updateDeleteButton() {
        const checkboxes = document.querySelectorAll('input[type="checkbox"][data-id]:checked');
        const deleteBtn = document.getElementById('btn-delete-selected');
        
        if (checkboxes.length > 0) {
            deleteBtn.disabled = false;
            deleteBtn.textContent = `선택 삭제 (${checkboxes.length})`;
        } else {
            deleteBtn.disabled = true;
            deleteBtn.textContent = '선택 삭제';
        }
    }
    
    // 로딩 상태 표시
    showLoading(show) {
        const loading = document.getElementById('loading-indicator');
        const tableContainer = document.querySelector('.data-table-container');
        
        if (show) {
            loading.style.display = 'block';
            tableContainer.style.display = 'none';
        } else {
            loading.style.display = 'none';
            tableContainer.style.display = 'block';
        }
    }
    
    // 빈 상태 표시
    showEmptyState(show) {
        const emptyState = document.getElementById('empty-state');
        const tableContainer = document.querySelector('.data-table-container');
        const cardsContainer = document.querySelector('.data-cards');
        
        if (show) {
            emptyState.style.display = 'block';
            tableContainer.style.display = 'none';
            cardsContainer.style.display = 'none';
        } else {
            emptyState.style.display = 'none';
        }
    }
}

// 전역 함수들 (버튼 onclick에서 사용)
function deleteItem(id) {
    console.log(`삭제 요청: ${id}`);
    if (confirm(`ID ${id} 항목을 삭제하시겠습니까?`)) {
        // 나중에 실제 삭제 API 호출
        alert(`ID ${id} 항목이 삭제되었습니다. (API 연동 추후 구현)`);
    }
}

</script>