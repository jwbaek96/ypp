<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YPP Admin Panel</title>
    
    <!-- CSS -->
    <link rel="stylesheet" href="/css/style.css">
    
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/e4704dcbbd.js" crossorigin="anonymous"></script>

    <!-- Style -->
    <style>
        :root{
            --mxw: 900px;
            --gap: 16px;
            --box-color: #d9d9d9;
            --line-color: #ececec;
        }
        body{
            /* background:  */
            /* linear-gradient(135deg, #eaeeff 0%, #ffffff 100%);min-height: 100dvh; */
            /* linear-gradient(135deg, #a0aad6 0%, #7abde2 100%); */
            min-height: 100dvh;
        }
        p, span{margin-bottom: 0; color: #000;}
        /* =========== */
        .main-container{ max-width: var(--mxw); margin: 0 auto; padding: 20px; box-sizing: border-box;}
        /* =========== Clock Styles =========== */
        header{width: 100%;}
        .header-clock {display: flex;margin-bottom: 20px;padding: 10px 0;}
        .clock-widget {font-size: 1.1rem;}
        /* =========== */
        .page-top{
            border-bottom: 1px solid var(--line-color);
            padding: 1rem 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
        }
        .page-title{font-size: 2.5rem;}
        .page-info{display: flex; flex-direction: column; gap: 4px; text-align: right;font-size: .8rem;}
        .page-count{font-size: 1.8rem;}
    </style>
</head>
<body>
    <div class="main-container">
        <header>
            <div class="header-clock">
                <div class="clock-widget">
                    <span class="clock-date" id="clock-date">2025년 11월 16일</span>
                    <span class="clock-time">
                        <span id="clock-hours">12</span>:<span id="clock-minutes">00</span><span class="clock-period" id="clock-period">PM</span>
                    </span>
                </div>
            </div>
        </header>
        <main>
            <div class="page-top">
                <div class="page-title">팝업</div>
                <div class="page-info">
                    <p class="page-descripation">페이지 디스크립션</p>
                    <p class="page-location">홈 > 팝업</p>
                    <p class="page-count">2건</p>
                </div>
            </div>
            <div class="page-mid"></div>
            <div class="modal-content"></div>
            <div class="modal-add"></div>
        </main>

</body>
</html>

<script>
// 페이지 로드 시 실행
document.addEventListener('DOMContentLoaded', () => {
    console.log('YPP Admin Page 초기화...');
    const clock = new Clock(); // 시계 인스턴스 생성
    clock.start(); // 시계 시작
    const pageManager = new PageManager(); // 페이지 매니저 생성
    pageManager.init(); // 페이지 초기화
});

// 시계 클래스
class Clock {
    constructor() {
        this.intervalId = null;
    }
    
    start() {
        this.updateClock(); // 즉시 시계 업데이트
        this.intervalId = setInterval(() => this.updateClock(), 1000); // 1초마다 업데이트
    }
    
    stop() {
        if (this.intervalId) {
            clearInterval(this.intervalId);
            this.intervalId = null;
        }
    }
    
    updateClock() {
        const now = new Date();
        
        // 시간 계산 (12시간 형식)
        let hours = now.getHours();
        const minutes = now.getMinutes();
        const period = hours >= 12 ? 'PM' : 'AM';
        
        // 12시간 형식으로 변환
        if (hours > 12) {
            hours = hours - 12;
        } else if (hours === 0) {
            hours = 12;
        }
        
        // 날짜 계산
        const year = now.getFullYear();
        const month = now.getMonth() + 1;
        const date = now.getDate();
        
        // DOM 업데이트 (한자리수도 그대로 표시)
        document.getElementById('clock-hours').textContent = hours.toString();
        document.getElementById('clock-minutes').textContent = minutes.toString().padStart(2, '0'); // 분은 항상 2자리
        document.getElementById('clock-period').textContent = period;
        document.getElementById('clock-date').textContent = `${year}년 ${month}월 ${date}일`;
    }
}

// 페이지 관리 클래스
class PageManager {
    constructor() {
        this.appsScriptUrl = 'https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec';
        this.pageConfigs = this.initPageConfigs();
    }
    
    // 페이지별 설정 데이터 초기화
    initPageConfigs() {
        return {
            '팝업': {
                title: '팝업',
                description: '홈페이지 팝업 관리',
                location: '홈 > 팝업',
                apiSheet: 'SHEET_DASHBOARD', // 임시
                dataKey: 'popup'
            },
            '인허가': {
                title: '갤러리 인허가',
                description: '인허가 관련 갤러리 이미지 관리',
                location: '갤러리 > 인허가',
                apiSheet: 'SHEET_GAL_A',
                dataKey: 'galA'
            },
            '유자격': {
                title: '갤러리 유자격',
                description: '유자격 관련 갤러리 이미지 관리',
                location: '갤러리 > 유자격',
                apiSheet: 'SHEET_GAL_B',
                dataKey: 'galB'
            },
            '인사이드': {
                title: '갤러리 인사이드',
                description: '인사이드 관련 갤러리 컨텐츠 관리',
                location: '갤러리 > 인사이드',
                apiSheet: 'SHEET_GAL_C',
                dataKey: 'galC'
            },
            '아카데미': {
                title: '갤러리 아카데미',
                description: '아카데미 관련 갤러리 컨텐츠 관리',
                location: '갤러리 > 아카데미',
                apiSheet: 'SHEET_GAL_F',
                dataKey: 'galD'
            },
            '보도자료': {
                title: '보도자료',
                description: '언론 보도자료 및 뉴스 관리',
                location: '게시판 > 보도자료',
                apiSheet: 'SHEET_BOARD_NEWS',
                dataKey: 'boardNews'
            },
            'PSAC': {
                title: 'PSAC 신청',
                description: 'PSAC 교육과정 신청서 관리',
                location: '아카데미 > PSAC',
                apiSheet: 'SHEET_APPLY_P',
                dataKey: 'applyPSAC'
            },
            'RelaySchool': {
                title: 'Relay School 신청',
                description: 'Relay School 교육과정 신청서 관리',
                location: '아카데미 > Relay School',
                apiSheet: 'SHEET_APPLY_R',
                dataKey: 'applyRelay'
            },
            '자주묻는질문': {
                title: '자주 묻는 질문',
                description: 'FAQ 관리',
                location: '고객센터 > 자주 묻는 질문',
                apiSheet: 'SHEET_DASHBOARD', // 임시
                dataKey: 'faq'
            },
            '고객문의': {
                title: '고객문의',
                description: '고객 문의사항 관리',
                location: '고객센터 > 고객문의',
                apiSheet: 'SHEET_HELP_KR',
                dataKey: 'helpKR'
            },
            '부패및윤리신고': {
                title: '부패 및 윤리 신고',
                description: '부패신고 및 윤리위반 신고 관리',
                location: '고객센터 > 부패 및 윤리 신고',
                apiSheet: 'SHEET_REPORT',
                dataKey: 'report'
            }
        };
    }
    
    // 페이지 초기화
    async init() {
        const urlParams = new URLSearchParams(window.location.search);
        const pageParam = urlParams.get('page');
        
        if (!pageParam) {
            this.showError('페이지 파라미터가 없습니다.');
            return;
        }
        
        console.log(`페이지 파라미터: ${pageParam}`);
        
        const config = this.pageConfigs[pageParam];
        if (!config) {
            this.showError(`알 수 없는 페이지: ${pageParam}`);
            return;
        }
        
        // 페이지 정보 업데이트
        this.updatePageInfo(config);
        
        // 데이터 카운트 로드
        await this.loadPageCount(config);
    }
    
    // 페이지 정보 업데이트
    updatePageInfo(config) {
        document.querySelector('.page-title').textContent = config.title;
        document.querySelector('.page-descripation').textContent = config.description;
        document.querySelector('.page-location').textContent = config.location;
        
        // 페이지 타이틀도 업데이트
        document.title = `YPP Admin - ${config.title}`;
    }
    
    // 페이지별 데이터 카운트 로드
    async loadPageCount(config) {
        try {
            console.log(`${config.title} 데이터 카운트 로드 중...`);
            
            // 대시보드에서 카운트 정보 가져오기
            const response = await fetch(`${this.appsScriptUrl}?sheet=SHEET_DASHBOARD`);
            const result = await response.json();
            
            if (!result.success) {
                throw new Error(result.message);
            }
            
            const count = result.data[config.dataKey] || 0;
            document.querySelector('.page-count').textContent = `${count}건`;
            
            console.log(`${config.title}: ${count}건`);
            
        } catch (error) {
            console.error('데이터 카운트 로드 실패:', error);
            document.querySelector('.page-count').textContent = '0건';
        }
    }
    
    // 에러 표시
    showError(message) {
        document.querySelector('.page-title').textContent = '오류';
        document.querySelector('.page-descripation').textContent = message;
        document.querySelector('.page-location').textContent = '오류 페이지';
        document.querySelector('.page-count').textContent = '0건';
        
        console.error('PageManager 오류:', message);
    }
}

</script>