<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO 메타 태그 -->
    <title>아카데미갤러리 - YPP</title>
    <meta name="description" content="YPP 아카데미갤러리 - PSAC, Relay School 교육 프로그램 갤러리">
    <meta name="keywords" content="YPP, 아카데미갤러리, PSAC, Relay School, 교육">
    
    <!-- 파비콘 -->
    <link rel="icon" type="image/ico" href="../../../assets/images/favicon/favicon.ico">
    
    <!-- CSS -->
    <link rel="stylesheet" href="../../../css/style.css">
    <link rel="stylesheet" href="../../../css/pages/layout.css">
    
    <!-- 메타 시스템 -->
    <!-- <script src="../../../js/head-meta.js"></script> -->
    
    <!-- Font Awesome -->
    <script src="https://kit.fontawesome.com/e4704dcbbd.js" crossorigin="anonymous"></script>
</head>
<body>
    <!-- Header Container -->
    <div id="header-container"></div>
    
    <!-- Mobile Sidebar Container -->
    <div id="sidebar-container"></div>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Page Header -->
        <section class="page-header">
            <div class="container">
                <div class="page-header-content">
                    <h1 class="page-title"data-eng="Academy Gallery"data-kor="아카데미갤러리">아카데미갤러리</h1>
                    <p class="page-subtitle"data-eng="YPP Academy Education Program Gallery"data-kor="YPP아카데미 교육 프로그램 갤러리">YPP아카데미 교육 프로그램 갤러리</p>
                </div>
            </div>
        </section>

        <!-- Breadcrumb -->
        <section class="breadcrumb-section">
            <div class="container">
                <nav class="breadcrumb">
                    <a href="/"data-eng="Home"data-kor="홈">홈</a>
                    <span class="breadcrumb-separator">></span>
                    <span data-eng="Media"data-kor="홍보">홍보</span>
                    <span class="breadcrumb-separator">></span>
                    <span data-eng="Gallery"data-kor="갤러리">갤러리</span>
                    <span class="breadcrumb-separator">></span>
                    <span class="breadcrumb-current"data-eng="Academy Gallery"data-kor="아카데미갤러리">아카데미갤러리</span>
                </nav>
            </div>
        </section>

        <!-- Section Navigation -->
        <section class="section-navigation">
            <div class="container">
                <nav class="section-nav">
                    <a href="#relay-school" class="section-nav-link active">Relay School</a>
                    <a href="#psac" class="section-nav-link">PSAC</a>
                </nav>
            </div>
        </section>

        <!-- Content Section -->
        <section class="content-section" style="min-height: 500px;">
            <div class="container">
            <!-- <div class="container" style="display: none;"> -->
                <div class="content-header">
                    <h2 class="content-title"
                        data-eng="Academy Gallery"
                        data-kor="아카데미갤러리">아카데미갤러리</h2>
                    <p class="content-subtitle"
                        data-eng="Experience the vivid scenes of YPP Academy's education programs"
                        data-kor="YPP아카데미 교육 프로그램의 생생한 현장을 만나보세요">YPP아카데미 교육 프로그램의 생생한 현장을 만나보세요</p>
                </div>
                
                <div class="content-grid">
                    <!-- Relay School -->
                    <div id="relay-school" class="content-block full-width">
                        <h3 class="block-title">Relay School</h3>
                        <div class="block-content">
                            <div id="relay-school-gallery" class="gallery-container">
                                <!-- Gallery Grid will be populated by JavaScript -->
                                <div class="gallery-grid" id="relay-school-gallery-grid"></div>
                                
                                <!-- Pagination -->
                                <div class="pagination-container" id="relay-school-pagination"></div>
                            </div>
                        </div>
                    </div>
                    <!-- PSAC -->
                    <div id="psac" class="content-block full-width">
                        <h3 class="block-title">PSAC</h3>
                        <div class="block-content">
                            <div id="psac-gallery" class="gallery-container">
                                <!-- Gallery Grid will be populated by JavaScript -->
                                <div class="gallery-grid" id="psac-gallery-grid"></div>
                                
                                <!-- Pagination -->
                                <div class="pagination-container" id="psac-pagination"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Image Popup Modal -->
    <div id="imageModal" class="image-modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div class="modal-header">
                <h3 id="modal-title"></h3>
                <p id="modal-date"></p>
            </div>
            <div class="modal-body">
                <div class="image-container" id="image-container">
                    <div class="image-touch-area left-touch" data-direction="prev"></div>
                    <div class="image-touch-area right-touch" data-direction="next"></div>
                    <img id="modal-image" src="" alt="">
                </div>
                <p id="modal-description"></p>
            </div>
            <div class="modal-footer">
                <button class="nav-btn prev-btn" id="prevImage">&lt;</button>
                <div class="image-counter">
                    <span id="current-image">1</span> / <span id="total-images">1</span>
                </div>
                <button class="nav-btn next-btn" id="nextImage">&gt;</button>
            </div>
        </div>
    </div>

    <!-- Footer Container -->
    <div id="footer-container"></div>

    <!-- Scripts -->
    <script src="../../../js/components.js"></script>
    <script src="../../../js/header-menu.js"></script>
    <script src="../../../js/sidebar.js"></script>
    <script src="../../../js/hamburger.js"></script>
    <script src="../../../js/main-top-padding.js"></script>
    <!-- 페이지준비중 팝업 스크립트 -->
    <!-- <script src="/js/content-preparing.js"></script> -->
    
    <!-- _________________________________________ -->
    <!-- 스크롤 탑 버튼 -->
    <div id="scrolltotop-container"></div>
    <!-- 최상단 가기 버튼 구현하기 -->
    <script src="/js/scrolltotop.js"></script>
    <script src="/js/lang-switch.js"></script>
    
    <!-- PSAC Gallery Script -->
    <script>

// 배포 ID
const DEPLOYMENT_ID = 'AKfycbwjhJWxaA9U48Rg_WBB1h-viX3y_d9dVKud5nEmDUfS6hn35jiICvvTnAbQ-9XuvkQj';
// 웹 앱 URL
const GOOGLE_APPS_SCRIPT_URL = `https://script.google.com/macros/s/${DEPLOYMENT_ID}/exec`;
// 전역 변수 선언
let psacGalleryData = [];
let relaySchoolGalleryData = [];

async function loadGalleryDataFromSheets() {
    try {
        console.log('📊 Google Sheets에서 갤러리 데이터 로드 시작...');
        
        const response = await fetch(`${GOOGLE_APPS_SCRIPT_URL}?category=all`);
        const result = await response.json();
        
        if (result.success) {
            console.log(`✅ 총 ${result.data.length}개의 데이터를 성공적으로 로드했습니다.`);
            
            // 카테고리별로 데이터 분리
            psacGalleryData = result.data.filter(item => 
                item.category && item.category.toLowerCase() === 'psac'
            ).reverse();
            
            relaySchoolGalleryData = result.data.filter(item => 
                item.category && item.category.toLowerCase() === 'relay school'
            ).reverse();
            
            console.log(`📋 PSAC 갤러리: ${psacGalleryData.length}개`);
            console.log(`📋 Relay School 갤러리: ${relaySchoolGalleryData.length}개`);
            console.log(psacGalleryData);
            console.log(relaySchoolGalleryData);

            return true;
        } else {
            throw new Error(`API 오류: ${result.error || '알 수 없는 오류'}`);
        }
        
    } catch (error) {
        console.error('💥 갤러리 데이터 로드 실패:', error);
        // 오류 발생 시 빈 배열로 초기화
        psacGalleryData = [];
        relaySchoolGalleryData = [];
        return false;
    }
}
// Gallery Modal Manager
class GalleryModalManager {
    constructor() {
        this.currentController = null;
        this.isInitialized = false;
        this.setupModal();
    }

    setCurrentController(controller) {
        this.currentController = controller;
    }

    setupModal() {
        if (this.isInitialized) return;
        
        const modal = document.getElementById('imageModal');
        const closeBtn = document.querySelector('.close-modal');
        const prevBtn = document.getElementById('prevImage');
        const nextBtn = document.getElementById('nextImage');
        const imageContainer = document.getElementById('image-container');
        const leftTouchArea = document.querySelector('.left-touch');
        const rightTouchArea = document.querySelector('.right-touch');

        // Touch/Drag variables
        let startX = 0;
        let startY = 0;
        let isDragging = false;
        let dragThreshold = 50;

        // Close modal
        closeBtn.addEventListener('click', () => {
            if (this.currentController) this.currentController.closeModal();
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal && this.currentController) {
                this.currentController.closeModal();
            }
        });

        // Navigation buttons
        prevBtn.addEventListener('click', () => {
            if (this.currentController) this.currentController.showPreviousImage();
        });

        nextBtn.addEventListener('click', () => {
            if (this.currentController) this.currentController.showNextImage();
        });

        // Touch area clicks
        leftTouchArea.addEventListener('click', () => {
            if (this.currentController) this.currentController.showPreviousImage();
        });

        rightTouchArea.addEventListener('click', () => {
            if (this.currentController) this.currentController.showNextImage();
        });

        // Touch events
        imageContainer.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
            isDragging = true;
        }, { passive: true });

        imageContainer.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
        }, { passive: false });

        imageContainer.addEventListener('touchend', (e) => {
            if (!isDragging || !this.currentController) return;
            
            const endX = e.changedTouches[0].clientX;
            const endY = e.changedTouches[0].clientY;
            const diffX = startX - endX;
            const diffY = startY - endY;

            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > dragThreshold) {
                if (diffX > 0) {
                    this.currentController.showNextImage();
                } else {
                    this.currentController.showPreviousImage();
                }
            }
            
            isDragging = false;
        }, { passive: true });

        // Mouse drag events
        imageContainer.addEventListener('mousedown', (e) => {
            startX = e.clientX;
            startY = e.clientY;
            isDragging = true;
            imageContainer.style.cursor = 'grabbing';
        });

        imageContainer.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
        });

        imageContainer.addEventListener('mouseup', (e) => {
            if (!isDragging || !this.currentController) return;
            
            const endX = e.clientX;
            const endY = e.clientY;
            const diffX = startX - endX;
            const diffY = startY - endY;

            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > dragThreshold) {
                if (diffX > 0) {
                    this.currentController.showNextImage();
                } else {
                    this.currentController.showPreviousImage();
                }
            }
            
            isDragging = false;
            imageContainer.style.cursor = 'grab';
        });

        imageContainer.addEventListener('mouseleave', () => {
            isDragging = false;
            imageContainer.style.cursor = 'grab';
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (modal.style.display === 'block' && this.currentController) {
                if (e.key === 'Escape') {
                    this.currentController.closeModal();
                } else if (e.key === 'ArrowLeft') {
                    this.currentController.showPreviousImage();
                } else if (e.key === 'ArrowRight') {
                    this.currentController.showNextImage();
                }
            }
        });

        this.isInitialized = true;
    }
}
// Create global modal manager instance
const modalManager = new GalleryModalManager();
// Gallery Controller Class
class PSACGalleryController {
    constructor(data, containerId, itemsPerPage = 12) {
        this.data = data.filter(item => item.state === "on");
        this.container = document.getElementById(containerId);
        this.itemsPerPage = itemsPerPage;
        this.currentPage = 1;
        this.totalPages = Math.ceil(this.data.length / this.itemsPerPage);
        this.currentModal = null;
        this.currentImageIndex = 0;
        
        this.init();
    }

    init() {
        this.renderGallery();
        this.renderPagination();
        this.setupModal();
    }

    renderGallery() {
        const startIndex = (this.currentPage - 1) * this.itemsPerPage;
        const endIndex = startIndex + this.itemsPerPage;
        const currentItems = this.data.slice(startIndex, endIndex);

        const galleryGrid = document.getElementById('psac-gallery-grid');
        galleryGrid.innerHTML = '';

        currentItems.forEach(item => {
            const galleryItem = document.createElement('div');
            galleryItem.className = 'gallery-item';
            
            const thumbnailImage = item.image[0];                    
            galleryItem.innerHTML = `
                <div class="gallery-thumbnail" data-id="${item.id}">
                    <img src="${thumbnailImage}" alt="${item.titleKR}" loading="lazy">
                    <div class="gallery-overlay">
                        <div class="gallery-info">
                            <h4 class="gallery-title" data-eng="${item.titleEN}" data-kor="${item.titleKR}">${item.titleKR}</h4>
                            <p class="gallery-date">${this.formatDate(item.date)}</p>
                        </div>
                    </div>
                </div>
            `;

            galleryItem.addEventListener('click', () => {
                this.openModal(item);
            });

            galleryGrid.appendChild(galleryItem);
        });
    }

    renderPagination() {
        const paginationContainer = document.getElementById('psac-pagination');
        paginationContainer.innerHTML = '';

        if (this.totalPages <= 1) return;

        const pagination = document.createElement('div');
        pagination.className = 'pagination';

        // Previous button
        if (this.currentPage > 1) {
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-btn';
            prevBtn.innerHTML = '&lt;';
            prevBtn.addEventListener('click', () => {
                this.currentPage--;
                this.renderGallery();
                this.renderPagination();
            });
            pagination.appendChild(prevBtn);
        }

        // Page numbers
        for (let i = 1; i <= this.totalPages; i++) {
            const pageBtn = document.createElement('button');
            pageBtn.className = `pagination-btn ${i === this.currentPage ? 'active' : ''}`;
            pageBtn.textContent = i;
            pageBtn.addEventListener('click', () => {
                this.currentPage = i;
                this.renderGallery();
                this.renderPagination();
            });
            pagination.appendChild(pageBtn);
        }

        // Next button
        if (this.currentPage < this.totalPages) {
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-btn';
            nextBtn.innerHTML = '&gt;';
            nextBtn.addEventListener('click', () => {
                this.currentPage++;
                this.renderGallery();
                this.renderPagination();
            });
            pagination.appendChild(nextBtn);
        }

        paginationContainer.appendChild(pagination);
    }

    setupModal() {
        const modal = document.getElementById('imageModal');
        const closeBtn = document.querySelector('.close-modal');
        const prevBtn = document.getElementById('prevImage');
        const nextBtn = document.getElementById('nextImage');
        const imageContainer = document.getElementById('image-container');
        const leftTouchArea = document.querySelector('.left-touch');
        const rightTouchArea = document.querySelector('.right-touch');

        // Touch/Drag variables
        let startX = 0;
        let startY = 0;
        let isDragging = false;
        let dragThreshold = 50; // minimum distance for swipe

        // Close modal
        closeBtn.addEventListener('click', () => {
            this.closeModal();
        });

        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                this.closeModal();
            }
        });

        // Navigation buttons
        prevBtn.addEventListener('click', () => {
            this.showPreviousImage();
        });

        nextBtn.addEventListener('click', () => {
            this.showNextImage();
        });

        // Touch area clicks
        leftTouchArea.addEventListener('click', () => {
            this.showPreviousImage();
        });

        rightTouchArea.addEventListener('click', () => {
            this.showNextImage();
        });

        // Touch events for mobile
        imageContainer.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
            isDragging = true;
        }, { passive: true });

        imageContainer.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
        }, { passive: false });

        imageContainer.addEventListener('touchend', (e) => {
            if (!isDragging) return;
            
            const endX = e.changedTouches[0].clientX;
            const endY = e.changedTouches[0].clientY;
            const diffX = startX - endX;
            const diffY = startY - endY;

            // Check if horizontal swipe is greater than vertical
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > dragThreshold) {
                if (diffX > 0) {
                    // Swipe left - next image
                    this.showNextImage();
                } else {
                    // Swipe right - previous image
                    this.showPreviousImage();
                }
            }
            
            isDragging = false;
        }, { passive: true });

        // Mouse drag events for desktop
        imageContainer.addEventListener('mousedown', (e) => {
            startX = e.clientX;
            startY = e.clientY;
            isDragging = true;
            imageContainer.style.cursor = 'grabbing';
        });

        imageContainer.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            e.preventDefault();
        });

        imageContainer.addEventListener('mouseup', (e) => {
            if (!isDragging) return;
            
            const endX = e.clientX;
            const endY = e.clientY;
            const diffX = startX - endX;
            const diffY = startY - endY;

            // Check if horizontal drag is greater than vertical
            if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > dragThreshold) {
                if (diffX > 0) {
                    // Drag left - next image
                    this.showNextImage();
                } else {
                    // Drag right - previous image
                    this.showPreviousImage();
                }
            }
            
            isDragging = false;
            imageContainer.style.cursor = 'grab';
        });

        // Mouse leave event
        imageContainer.addEventListener('mouseleave', () => {
            isDragging = false;
            imageContainer.style.cursor = 'grab';
        });

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (modal.style.display === 'block') {
                if (e.key === 'Escape') {
                    this.closeModal();
                } else if (e.key === 'ArrowLeft') {
                    this.showPreviousImage();
                } else if (e.key === 'ArrowRight') {
                    this.showNextImage();
                }
            }
        });
    }

    openModal(item) {
        this.currentModal = item;
        this.currentImageIndex = 0;
        
        const modal = document.getElementById('imageModal');
        const modalTitle = document.getElementById('modal-title');
        const modalDate = document.getElementById('modal-date');
        const modalDescription = document.getElementById('modal-description');
        const totalImages = document.getElementById('total-images');

        modalTitle.textContent = item.titleKR;
        modalTitle.setAttribute('data-eng', item.titleEN);
        modalTitle.setAttribute('data-kor', item.titleKR);
        modalDate.textContent = this.formatDate(item.date);
        modalDescription.textContent = item.text;
        totalImages.textContent = item.image.length;

        this.updateModalImage();
        modal.style.display = 'block';
        document.body.style.overflow = 'hidden';
    }

    closeModal() {
        const modal = document.getElementById('imageModal');
        modal.style.display = 'none';
        document.body.style.overflow = 'auto';
        this.currentModal = null;
    }

    showPreviousImage() {
        if (this.currentModal && this.currentImageIndex > 0) {
            this.currentImageIndex--;
            this.updateModalImage();
        }
    }

    showNextImage() {
        if (this.currentModal && this.currentImageIndex < this.currentModal.image.length - 1) {
            this.currentImageIndex++;
            this.updateModalImage();
        }
    }

    updateModalImage() {
        if (!this.currentModal) return;

        const modalImage = document.getElementById('modal-image');
        const currentImageSpan = document.getElementById('current-image');
        
        modalImage.src = this.currentModal.image[this.currentImageIndex];
        modalImage.alt = this.currentModal.titleKR;
        currentImageSpan.textContent = this.currentImageIndex + 1;

        // Update navigation buttons state
        const prevBtn = document.getElementById('prevImage');
        const nextBtn = document.getElementById('nextImage');
        
        // Always show buttons but disable when appropriate
        prevBtn.style.display = 'flex';
        nextBtn.style.display = 'flex';
        
        // Disable/enable buttons based on current position
        prevBtn.disabled = this.currentImageIndex === 0;
        nextBtn.disabled = this.currentImageIndex === this.currentModal.image.length - 1;
        
        // Hide both buttons only if there's only one image
        if (this.currentModal.image.length <= 1) {
            prevBtn.style.display = 'none';
            nextBtn.style.display = 'none';
        }
    }

    formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('ko-KR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
    }
}
// Relay School Gallery Controller Class
class RelaySchoolGalleryController {
            constructor(data, containerId, itemsPerPage = 12) {
                this.data = data.filter(item => item.state === "on");
                this.container = document.getElementById(containerId);
                this.itemsPerPage = itemsPerPage;
                this.currentPage = 1;
                this.totalPages = Math.ceil(this.data.length / this.itemsPerPage);
                this.currentModal = null;
                this.currentImageIndex = 0;
                
                this.init();
            }

            init() {
                this.renderGallery();
                this.renderPagination();
                this.setupModal();
            }

            renderGallery() {
                const startIndex = (this.currentPage - 1) * this.itemsPerPage;
                const endIndex = startIndex + this.itemsPerPage;
                const currentItems = this.data.slice(startIndex, endIndex);

                const galleryGrid = document.getElementById('relay-school-gallery-grid');
                galleryGrid.innerHTML = '';

                currentItems.forEach(item => {
                    const galleryItem = document.createElement('div');
                    galleryItem.className = 'gallery-item';
                    
                    const thumbnailImage = item.image[0];
                    
                    galleryItem.innerHTML = `
                        <div class="gallery-thumbnail" data-id="${item.id}">
                            <img src="${thumbnailImage}" alt="${item.titleKR}" loading="lazy">
                            <div class="gallery-overlay">
                                <div class="gallery-info">
                                    <h4 class="gallery-title" data-eng="${item.titleEN}" data-kor="${item.titleKR}">${item.titleKR}</h4>
                                    <p class="gallery-date">${this.formatDate(item.date)}</p>
                                </div>
                            </div>
                        </div>
                    `;

                    galleryItem.addEventListener('click', () => {
                        this.openModal(item);
                    });

                    galleryGrid.appendChild(galleryItem);
                });
            }

            renderPagination() {
                const paginationContainer = document.getElementById('relay-school-pagination');
                paginationContainer.innerHTML = '';

                if (this.totalPages <= 1) return;

                const pagination = document.createElement('div');
                pagination.className = 'pagination';

                // Previous button
                if (this.currentPage > 1) {
                    const prevBtn = document.createElement('button');
                    prevBtn.className = 'pagination-btn';
                    prevBtn.innerHTML = '&lt;';
                    prevBtn.addEventListener('click', () => {
                        this.currentPage--;
                        this.renderGallery();
                        this.renderPagination();
                    });
                    pagination.appendChild(prevBtn);
                }

                // Page numbers
                for (let i = 1; i <= this.totalPages; i++) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = `pagination-btn ${i === this.currentPage ? 'active' : ''}`;
                    pageBtn.textContent = i;
                    pageBtn.addEventListener('click', () => {
                        this.currentPage = i;
                        this.renderGallery();
                        this.renderPagination();
                    });
                    pagination.appendChild(pageBtn);
                }

                // Next button
                if (this.currentPage < this.totalPages) {
                    const nextBtn = document.createElement('button');
                    nextBtn.className = 'pagination-btn';
                    nextBtn.innerHTML = '&gt;';
                    nextBtn.addEventListener('click', () => {
                        this.currentPage++;
                        this.renderGallery();
                        this.renderPagination();
                    });
                    pagination.appendChild(nextBtn);
                }

                paginationContainer.appendChild(pagination);
            }

            setupModal() {
                const modal = document.getElementById('imageModal');
                const closeBtn = document.querySelector('.close-modal');
                const prevBtn = document.getElementById('prevImage');
                const nextBtn = document.getElementById('nextImage');
                const imageContainer = document.getElementById('image-container');
                const leftTouchArea = document.querySelector('.left-touch');
                const rightTouchArea = document.querySelector('.right-touch');

                // Touch/Drag variables
                let startX = 0;
                let startY = 0;
                let isDragging = false;
                let dragThreshold = 50; // minimum distance for swipe

                // Close modal
                closeBtn.addEventListener('click', () => {
                    this.closeModal();
                });

                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        this.closeModal();
                    }
                });

                // Navigation buttons
                prevBtn.addEventListener('click', () => {
                    this.showPreviousImage();
                });

                nextBtn.addEventListener('click', () => {
                    this.showNextImage();
                });

                // Touch area clicks
                leftTouchArea.addEventListener('click', () => {
                    this.showPreviousImage();
                });

                rightTouchArea.addEventListener('click', () => {
                    this.showNextImage();
                });

                // Touch events for mobile
                imageContainer.addEventListener('touchstart', (e) => {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                    isDragging = true;
                }, { passive: true });

                imageContainer.addEventListener('touchmove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                }, { passive: false });

                imageContainer.addEventListener('touchend', (e) => {
                    if (!isDragging) return;
                    
                    const endX = e.changedTouches[0].clientX;
                    const endY = e.changedTouches[0].clientY;
                    const diffX = startX - endX;
                    const diffY = startY - endY;

                    // Check if horizontal swipe is greater than vertical
                    if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > dragThreshold) {
                        if (diffX > 0) {
                            // Swipe left - next image
                            this.showNextImage();
                        } else {
                            // Swipe right - previous image
                            this.showPreviousImage();
                        }
                    }
                    
                    isDragging = false;
                }, { passive: true });

                // Mouse drag events for desktop
                imageContainer.addEventListener('mousedown', (e) => {
                    startX = e.clientX;
                    startY = e.clientY;
                    isDragging = true;
                    imageContainer.style.cursor = 'grabbing';
                });

                imageContainer.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;
                    e.preventDefault();
                });

                imageContainer.addEventListener('mouseup', (e) => {
                    if (!isDragging) return;
                    
                    const endX = e.clientX;
                    const endY = e.clientY;
                    const diffX = startX - endX;
                    const diffY = startY - endY;

                    // Check if horizontal drag is greater than vertical
                    if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > dragThreshold) {
                        if (diffX > 0) {
                            // Drag left - next image
                            this.showNextImage();
                        } else {
                            // Drag right - previous image
                            this.showPreviousImage();
                        }
                    }
                    
                    isDragging = false;
                    imageContainer.style.cursor = 'grab';
                });

                // Mouse leave event
                imageContainer.addEventListener('mouseleave', () => {
                    isDragging = false;
                    imageContainer.style.cursor = 'grab';
                });

                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (modal.style.display === 'block') {
                        if (e.key === 'Escape') {
                            this.closeModal();
                        } else if (e.key === 'ArrowLeft') {
                            this.showPreviousImage();
                        } else if (e.key === 'ArrowRight') {
                            this.showNextImage();
                        }
                    }
                });
            }

            openModal(item) {
                modalManager.setCurrentController(this);
                this.currentModal = item;
                this.currentImageIndex = 0;
                
                const modal = document.getElementById('imageModal');
                const modalTitle = document.getElementById('modal-title');
                const modalDate = document.getElementById('modal-date');
                const modalDescription = document.getElementById('modal-description');
                const totalImages = document.getElementById('total-images');

                modalTitle.textContent = item.titleKR;
                modalTitle.setAttribute('data-eng', item.titleEN);
                modalTitle.setAttribute('data-kor', item.titleKR);
                modalDate.textContent = this.formatDate(item.date);
                modalDescription.textContent = item.text;
                totalImages.textContent = item.image.length;

                this.updateModalImage();
                modal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }

            closeModal() {
                const modal = document.getElementById('imageModal');
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
                this.currentModal = null;
            }

            showPreviousImage() {
                if (this.currentModal && this.currentImageIndex > 0) {
                    this.currentImageIndex--;
                    this.updateModalImage();
                }
            }

            showNextImage() {
                if (this.currentModal && this.currentImageIndex < this.currentModal.image.length - 1) {
                    this.currentImageIndex++;
                    this.updateModalImage();
                }
            }

            updateModalImage() {
                if (!this.currentModal) return;

                const modalImage = document.getElementById('modal-image');
                const currentImageSpan = document.getElementById('current-image');
                
                modalImage.src = this.currentModal.image[this.currentImageIndex];
                modalImage.alt = this.currentModal.titleKR;
                currentImageSpan.textContent = this.currentImageIndex + 1;

                // Update navigation buttons state
                const prevBtn = document.getElementById('prevImage');
                const nextBtn = document.getElementById('nextImage');
                
                // Always show buttons but disable when appropriate
                prevBtn.style.display = 'flex';
                nextBtn.style.display = 'flex';
                
                // Disable/enable buttons based on current position
                prevBtn.disabled = this.currentImageIndex === 0;
                nextBtn.disabled = this.currentImageIndex === this.currentModal.image.length - 1;
                
                // Hide both buttons only if there's only one image
                if (this.currentModal.image.length <= 1) {
                    prevBtn.style.display = 'none';
                    nextBtn.style.display = 'none';
                }
            }

            formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('ko-KR', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }
        }

// 기존 DOMContentLoaded 이벤트를 수정
document.addEventListener('DOMContentLoaded', async function() {
    const navLinks = document.querySelectorAll('.section-nav-link');
    const sections = [
        document.getElementById('relay-school'),
        document.getElementById('psac')
    ];

    function onScrollSpy() {
        let currentId = '';
        sections.forEach(section => {
            if (!section) return;
            const rect = section.getBoundingClientRect();
            if (rect.top <= 120 && rect.bottom > 120) {
                currentId = section.id;
            }
        });

        navLinks.forEach(link => {
            link.classList.toggle('active', link.getAttribute('href') === `#${currentId}`);
        });
    }

    window.addEventListener('scroll', onScrollSpy);
    onScrollSpy(); // 초기화



    // Google Sheets에서 데이터 로드
    const success = await loadGalleryDataFromSheets();
    
    if (success) {
        // 기존 갤러리 컨트롤러 초기화
        new PSACGalleryController(psacGalleryData, 'psac-gallery');
        new RelaySchoolGalleryController(relaySchoolGalleryData, 'relay-school-gallery', 12);
    } else {
        console.error('갤러리 데이터 로드 실패로 빈 갤러리를 표시합니다.');
        // 실패해도 빈 배열로 갤러리 초기화
        new PSACGalleryController([], 'psac-gallery');
        new RelaySchoolGalleryController([], 'relay-school-gallery', 12);
    }
});
</script>
<!-- 스크롤 스파이 - 섹션 nav 활성화 -->
<script>
    // ...existing code...

// 스크롤 스파이 - 섹션 네비게이션 활성화
</script>
<!-- Gallery Styles -->
<style>
    .content-block{border: none;}
    .content-block:hover{box-shadow: none;}
    /* ===========================
        Gallery Components
    =========================== */

    /* Gallery Container */
    .gallery-container {width: 100%;}
    /* Gallery Grid */
    .gallery-grid {display: grid;grid-template-columns: repeat(4, 1fr);gap: 20px;margin-bottom: 40px;}
    /* Gallery Item */
    .gallery-item {position: relative;cursor: pointer;border-radius: 8px;overflow: hidden;transition: transform 0.3s ease, box-shadow 0.3s ease;}
    .gallery-item:hover {transform: translateY(-5px);box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);}
    /* Gallery Thumbnail */
    .gallery-thumbnail {position: relative;width: 100%;aspect-ratio: 4/3;overflow: hidden;background: #f5f5f5;}
    .gallery-thumbnail img {width: 100%;height: 100%;object-fit: cover;transition: transform 0.3s ease;}
    .gallery-item:hover .gallery-thumbnail img {transform: scale(1.05);}
    /* Gallery Overlay */
    .gallery-overlay {
        display: flex;align-items: center;justify-content: center;
        position: absolute;top: 0;bottom: 0;left: 0;right: 0;
        background: rgba(0, 0, 0, 0.7);padding: 20px;opacity: 0;transition: opacity 0.3s ease;}
    .gallery-item:hover .gallery-overlay {opacity: 1;}
    .gallery-info h4,
    .gallery-info p{color: #fff; text-align: center;}
    .gallery-info h4 {font-size: 14px;font-weight: 600;margin: 0 0 5px 0;line-height: 1.3;}
    .gallery-info p {font-size: 12px;margin: 0;opacity: 0.9;}
    /* Pagination */
    .pagination-container {display: flex;justify-content: center;margin-top: 40px;}
    .pagination {display: flex;gap: 5px;align-items: center;}
    .pagination-btn {padding: 8px 12px;border: 1px solid #ddd;background: white;cursor: pointer;border-radius: 4px;color: #333;font-size: 14px;transition: all 0.3s ease;}
    .pagination-btn:hover {background: #f0f0f0;}
    .pagination-btn.active {background: #007bff;color: white;border-color: #007bff;}
    /* Image Modal */
    .image-modal {display: none;position: fixed;z-index: 10000;left: 0;top: 0;width: 100%;height: 100%;background: rgba(0, 0, 0, 0.13);}
    .modal-content {position: relative;background: white;margin: 2% auto;max-width: 90%;max-height: 90%;height: 100%;border-radius: 8px;overflow: hidden;display: flex;flex-direction: column;}
    .close-modal {
        position: absolute;top: 15px;right: 20px;z-index: 10001;
        color: #666;font-size: 28px;font-weight: bold;
        cursor: pointer;
        width: 30px;height: 30px;
        display: flex;align-items: center;justify-content: center;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.9);
        transition: all 0.3s ease;
    }
    .close-modal:hover {background: rgba(255, 255, 255, 1);color: #000;}
    .modal-header {padding: 20px;border-bottom: 1px solid #eee;}
    .modal-header h3 {margin: 0 0 5px 0;font-size: 18px;color: #333;}
    .modal-header p {margin: 0;color: #666;font-size: 14px;}
    .modal-body {flex: 1;position: relative;display: flex;flex-direction: column; overflow: hidden;}
    .image-container {position: relative;flex: 1;display: flex;align-items: center;justify-content: center;background: #f9f9f9;min-height: 400px;cursor: grab;user-select: none;}
    .image-container:active {cursor: grabbing;}
    .image-container img {max-width: 100%;max-height: 70vh;object-fit: contain;pointer-events: none;}
    /* Touch areas for left/right navigation */
    .image-touch-area {position: absolute;top: 0;bottom: 0;width: 50%;cursor: pointer;z-index: 100;}
    .left-touch {left: 0;}
    .right-touch {right: 0;}
    .modal-body p {padding: 20px;margin: 0;color: #666;line-height: 1.6;max-height: 30%;}
    .modal-footer {padding: 20px;border-top: 1px solid #eee;display: flex;align-items: center;justify-content: space-between;}
    .nav-btn {
        display: flex;align-items: center;justify-content: center;
        width: 40px;height: 40px; flex: 1; padding: 0 30px;
        background: none;border: none;cursor: pointer;
        color: #333;font-size: 18px;font-weight: bold;
        transition: all 0.3s ease;}
    .nav-btn:hover {color: #858585;}
    .nav-btn:disabled {opacity: 0.3;cursor: not-allowed;background: #f8f8f8;color: #ccc;border-color: #e0e0e0;}
    .nav-btn:disabled:hover {background: #f8f8f8;color: #ccc;border-color: #e0e0e0;}
    .image-counter {color: #666;font-size: 14px;text-align: center;}
    .prev-btn {justify-content: flex-start;}
    .next-btn {justify-content: flex-end;}

    /* Responsive Design */
    @media (max-width: 1200px) {
        .gallery-grid {grid-template-columns: repeat(3, 1fr);gap: 15px;}
    }

    @media (max-width: 768px) {
        .gallery-grid {grid-template-columns: repeat(2, 1fr);gap: 12px;}
        .gallery-overlay {padding: 15px;}
        .gallery-info h4 {font-size: 13px;}
        .gallery-info p {font-size: 11px;}
        .modal-content {margin: 5% auto;max-width: 95%;max-height: 95%;}
        .modal-header {padding: 15px;}
        .modal-header h3 {font-size: 16px;}
        .nav-btn {width: 35px;height: 35px;font-size: 16px;}
        .prev-btn {justify-content: center;}
        .next-btn {justify-content: center;}
        .modal-footer {padding: 15px;}
    }

    @media (max-width: 480px) {            
        .gallery-overlay {transform: translateY(0);background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));}
        .pagination-btn {padding: 6px 10px;font-size: 12px;}
        .nav-btn {width: 30px;height: 30px;font-size: 14px;}
    }
</style>
<!-- _________________________________________ -->
